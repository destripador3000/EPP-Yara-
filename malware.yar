rule Advanced_Malware_Detector
{
    meta:
        description = "Detecci칩n de keyloggers, malware, virus y reverse shells"
        author = "Juan Esteban"
        date = "2025-02-12"
        version = "2.1"

    strings:
        // 游댳 Funciones usadas en keyloggers
        $keylog1 = "GetAsyncKeyState" nocase
        $keylog2 = "SetWindowsHookEx" nocase
        $keylog3 = "CreateFileA" nocase
        $keylog4 = "WriteFile" nocase
        $keylog5 = "log.txt" nocase

        // 游댳 Strings comunes en malware y virus
        $malware1 = "malicious_code" nocase
        $malware2 = "exploit" nocase
        $malware3 = "payload" nocase
        $malware4 = "Trojan" nocase
        $malware5 = "backdoor" nocase

        // 游댳 C칩digo en ensamblador usado en malware (shellcodes)
        $hex1 = { E8 ?? ?? ?? ?? 83 C4 04 }  // Llamada a funci칩n sospechosa
        $hex2 = { 90 90 90 90 }  // NOP sled, solo si est치 acompa침ado de otro indicio
        $hex3 = { 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? C3 }  // Llamadas sospechosas
        
        // 游댳 Funciones de reverse shell
        $reverse_shell1 = "socket" nocase
        $reverse_shell2 = "connect" nocase
        $reverse_shell3 = "ws2_32.dll" nocase
        $reverse_shell4 = "/bin/sh" nocase
        $reverse_shell5 = "cmd.exe" nocase

        // 游댳 Indicadores de conexiones remotas sospechosas
        $network1 = "http://" nocase
        $network2 = "ftp://" nocase
        $network3 = "socks://" nocase
        $network4 = "proxy" nocase
        $network5 = "127.0.0.1" nocase

    condition:
        (
            (2 of ($keylog*)) or  
            (2 of ($malware*)) or  
            (2 of ($reverse_shell*)) or  
            ((2 of ($network*)) and (1 of ($malware*))) or  // Se requiere al menos un indicador de malware junto con actividad sospechosa de red
            ((1 of ($hex*)) and (1 of ($reverse_shell*))) // Shellcode solo es sospechoso si se encuentra junto a una reverse shell
        )
}
