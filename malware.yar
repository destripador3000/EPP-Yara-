rule Advanced_Malware_Detector
{
    meta:
        description = "Detección de keyloggers, malware, virus y reverse shells"
        author = "Juan Esteban"
        date = "2025-02-12"
        version = "2.0"

    strings:
        // 🔹 Funciones usadas en keyloggers
        $keylog1 = "GetAsyncKeyState" nocase
        $keylog2 = "SetWindowsHookEx" nocase
        $keylog3 = "CreateFileA" nocase
        $keylog4 = "WriteFile" nocase
        $keylog5 = "log.txt" nocase

        // 🔹 Strings comunes en malware y virus
        $malware1 = "malicious_code" nocase
        $malware2 = "exploit" nocase
        $malware3 = "payload" nocase
        $malware4 = "Trojan" nocase
        $malware5 = "backdoor" nocase

        // 🔹 Código en ensamblador usado en malware (shellcodes)
        $hex1 = { E8 ?? ?? ?? ?? 83 C4 04 }  // Llamada a función sospechosa
        $hex2 = { 90 90 90 90 }  // NOP sled (usado en exploits)
        $hex3 = { 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? C3 }  // Llamadas sospechosas

        // 🔹 Funciones de reverse shell
        $reverse_shell1 = "socket" nocase
        $reverse_shell2 = "connect" nocase
        $reverse_shell3 = "ws2_32.dll" nocase
        $reverse_shell4 = "/bin/sh" nocase
        $reverse_shell5 = "cmd.exe" nocase

        // 🔹 Indicadores de conexiones remotas sospechosas
        $network1 = "http://" nocase
        $network2 = "ftp://" nocase
        $network3 = "socks://" nocase
        $network4 = "proxy" nocase
        $network5 = "127.0.0.1" nocase  // Puede indicar pruebas de malware

    condition:
        (2 of ($keylog*)) or  // Detecta keyloggers
        (2 of ($malware*)) or // Detecta malware o virus
        (2 of ($reverse_shell*)) or // Detecta reverse shells
        (2 of ($network*)) or // Detecta actividad de red sospechosa
        (any of ($hex*)) // Detecta shellcodes y código malicioso
}
